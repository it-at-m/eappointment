{% extends "layout/main.twig" %}
{% use "block/report/advancedInfo.twig" %}
{% block content %}
<div class="counter-view" data-includeurl="{{ includeUrl() }}">
        <div class="report-index">
            {% embed "block/report/period.twig" with {"source":source, "items": requestPeriod, "selected": period} %}
                {% block breadcrumb %}
                <ul class="report-period--breadcrumb">
                    {% set arguments = {} %}
                    {% if period %}
                        {% set arguments = {"period": period} %}
                    {% endif %}
                    <li class="report-period--subject">{{ title|trans }}</li>
                    <li><a class="{{ activeOrganisation }}" href="{{ urlGet("ReportRequestOrganisation", arguments, {}) }}">{{ organisation.name }}</a></li>
                    <li><a class="{{ activeDepartment }}" href="{{ urlGet("ReportRequestDepartment", arguments, {}) }}">{{ department.name }}</a></li>
                    <li><a class="{{ activeScope }}" href="{{ urlGet("ReportRequestIndex", arguments, {}) }}">{{workstation.scope.contact.name}} {{workstation.scope.shortName}}</a></li>
                </ul>
                </ul>
                {% endblock %}
            {% endembed %}

            {% embed "block/report/board.twig" with {'source':source, 'class': 'report-board', "selected": period} %}
            {% block board_body %}
            {% if selected %}
                {% if exchangeRequest.period == "day" %}
                    {% set startDate = "%s-%s-%s"|format(exchangeRequest.firstDay.year, exchangeRequest.firstDay.month, exchangeRequest.firstDay.day) %}
                    {% set endDate = "%s-%s-%s"|format(exchangeRequest.lastDay.year, exchangeRequest.lastDay.month, exchangeRequest.lastDay.day) %}
                    {% set dateRange = range(startDate|date('U'), endDate|date('U'), 86400 ) %}
                {% elseif exchangeRequest.period == "month" %}
                    {% set startDate = "%s-%s"|format(exchangeRequest.firstDay.year, exchangeRequest.firstDay.month) %}
                    {% set endDate = "%s-%s"|format(exchangeRequest.lastDay.year, exchangeRequest.lastDay.month) %}
                    {% set dateRange = range(startDate|date('n'), endDate|date('n'), 1 ) %}
                {% endif %}
                <table class="report-board--table report-board--narrow">
                    <thead>
                        <th class="statistik">
                            <span class="keinumbruch">
                                {% trans %}Dienstleistung{% endtrans %}
                            </span>
                        </th>
                        {% if exchangeRequest.period == "day" %}
                            <th class="statistik">{{ startDate|localizeddate("MEDIUM","none",NULL,NULL,"LLL") }}</th>
                        {% elseif exchangeRequest.period == "month" %}
                            <th class="statistik">{{ startDate|date('Y') }}</th>
                        {% endif %}
                        {% for date in dateRange %}
                            {% if exchangeRequest.period == "day" %}
                                <th class="statistik">&nbsp;{{ date|date('d') }}</th>
                            {% elseif exchangeRequest.period == "month" %}
                                <th class="statistik">&nbsp;{{ (startDate|date('Y') ~"-"~ "%02d"|format(date))|localizeddate("MEDIUM","none",NULL,NULL,"LLL") }}</th>
                            {% endif %}
                        {% endfor %}
                    </thead>
                    <tbody class="">
                        {% for name, entry in exchangeRequest.data if name != "sum" %}
                        <tr>
                            <th class="report-board--long-text">{{ name|trans }}</th>
                            <td class="report-board--summary">
                                {{ exchangeRequest.data.sum[name] }}
                            </td>
                            {% for date in dateRange %}
                                {% if exchangeRequest.period == "day" %}
                                    {% set date = date|date("Y-m-d") %}
                                {% elseif exchangeRequest.period == "month" %}
                                    {% set date = startDate|date('Y') ~"-"~ "%02d"|format(date) %}
                                {% endif %}
                                <td>
                                    {{ entry[date].requestscount|default(0) }}
                                </td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                {{ block("board_body_noperiod") }}
            {% endif %}
            {% endblock %}
            {% endembed %}
        </div>
    </div>
{% endblock %}
