#!/usr/bin/env php
<?php
require_once __DIR__ . '/script_bootstrap.php';

$now = date('Y-m-d H:i:s');
$logPrefix = '[cleanupOverviewCalendar]';

if (isset(\App::$log)) {
    \App::$log->info("$logPrefix Start", ['timestamp' => $now]);
} else {
    error_log("$logPrefix Start at $now");
}

if (!in_array('--commit', $argv, true)) {
    if (isset(\App::$log)) {
        \App::$log->info("$logPrefix Dry run (no --commit), exiting.");
    } else {
        error_log("$logPrefix Dry run (no --commit), exiting.");
    }
    exit(0);
}

$svc = new \BO\Zmsdb\OverviewCalendar();
$svc->deleteOlderThan(new DateTimeImmutable('today'));

$end = date('Y-m-d H:i:s');
if (isset(\App::$log)) {
    \App::$log->info("$logPrefix Finished", ['timestamp' => $end]);
} else {
    error_log("$logPrefix Finished at $end");
}
