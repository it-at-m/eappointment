#!/usr/bin/env php
<?php
/**
 * calculate average waiting times for each scope, date, and hour,
 * separated by 'spontan' vs. 'termin', and store results into wartenrstatistik.
 */
require_once(__DIR__."/script_bootstrap.php");

if (isset(\App::$log)) {
    \App::$log->info("calculateDailyWaitingStatistic: calculate average waiting times");
} else {
    echo "calculateDailyWaitingStatistic: calculate average waiting times\n";
}

$verbose = in_array('--verbose', $argv);
$commit  = in_array('--commit',  $argv);

$targetDate = (new \DateTimeImmutable())->modify('-1 day');

$job = new BO\Zmsdb\Helper\CalculateDailyWaitingStatisticByCron();

$job->run($targetDate, $commit);

if (!$commit) {
    $message = "[DRY RUN] Nothing was written to the database. Use --commit to persist data.";
    if (isset(\App::$log)) {
        \App::$log->info($message);
    } else {
        echo "\n$message\n";
    }
}
