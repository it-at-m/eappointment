#!/bin/bash

REALPATH=$(which realpath || which readlink)
REALPATH=$([[ "$REALPATH" =~ 'readlink' ]] && echo "$REALPATH -e" || echo "$REALPATH")
DIR=$(dirname $($REALPATH ${BASH_SOURCE[0]}))
ROOT=$($REALPATH $DIR/..)

#echo "Get DLDB Exports"
#$ROOT/bin/getDldbExport

echo -n "Configuring application"
mkdir -p $ROOT/.git/hooks
ln -sf $ROOT/bin/test $ROOT/.git/hooks/pre-commit
ln -sf $ROOT/bin/configure $ROOT/.git/hooks/post-checkout
ln -sf $ROOT/bin/configure $ROOT/.git/hooks/post-commit
ln -sf $ROOT/bin/configure $ROOT/.git/hooks/post-merge

if [ ! -e $ROOT/config.php ]
then	
    cp $ROOT/config.example.php $ROOT/config.php
fi
if [ -d $ROOT/cache ]; then
    if ! chmod -R a+rwX $ROOT/cache 2>/dev/null; then
        echo "Warning: Could not set permissions on cache directory"
    fi
else
    echo "Warning: Cache directory does not exist at $ROOT/cache"
fi


#VERSION=`git symbolic-ref -q --short HEAD || git describe --tags --exact-match`
VERSION=`git describe --tags --always`
echo $VERSION > $ROOT/VERSION
echo " $VERSION"
