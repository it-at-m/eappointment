{% embed "block/scaffholding/board.twig" with {'class': 'board--spaceless searchresults'} %}

    {% block board_body %}
        <script>
            document.getElementById("search-result-title").focus();
        </script>

        <form method="get" action="">
            <div class="grid m-5">
                <div class="grid__item one-whole" style="margin-bottom: 12px;">
                    <label for="calendar-date-from" class="form-label">Gesamtsuche</label><br>
                    <input type="text" name="query" value="{{ searchProcessQuery }}" style="width: 100%;height: 30px;">
                </div>

                <div class="grid__item six-twelfths" style="margin-bottom: 12px;">
                    <label for="calendar-date-from" class="form-label">Dienstleistung</label><br>
                    <input type="text" name="service" value="{{ service }}" style="width: 100%;height: 30px;">
                </div>

                <div class="grid__item six-twelfths" style="margin-bottom: 12px;">
                    <label for="calendar-date-from" class="form-label">Standort</label><br>
                    <input type="text" name="provider" value="{{ provider }}" style="width: 100%;height: 30px;">
                </div>

                <div class="grid__item six-twelfths" style="margin-bottom: 12px;">
                    <label for="calendar-date-from" class="form-label">Datum</label>
                    <input type="date" id="adsa" name="date" value="{{ date }}" class="form-control">
                </div>

                <div class="grid__item six-twelfths" style="margin-bottom: 12px;">
                    <label for="calendar-date-from" class="form-label">Sachbearbeiter</label><br>

                    <input type="radio" name="user" value="1" {% if userAction == 1 %}checked="checked"{% endif %}> <label for="1">Ja</label>
                    <input type="radio" name="user" value="2" {% if userAction == 2 %}checked="checked"{% endif %}> <label for="2">Nein</label>
                    <input type="radio" name="user" value="0" {% if userAction == 0 %}checked="checked"{% endif %}> <label for="3">Egal</label>
                </div>

                <input type="hidden" name="perPage" value="{{ perPage }}">

                <div class="grid__item six-twelfths" style="margin-bottom: 12px;">
                    <button type="submit" class="btn btn-primary">Übernehmen</button>
                </div>
            </div>
        </form>

        <div tabindex="1" class="table-responsive-wrapper">
            <table class="table--base" data-processList-count="{{ processList.count() }}"  data-processListOther-count="{{ processListOther.count() }}">
                <thead>
                <tr>
                    <th>Name (Nr.)</th>
                    <th>Datum</th>
                    <th>Ort</th>
                    <th>Telefon</th>
                    <th>E-Mail</th>
                    <th>Anmerkung</th>
                </tr>
                </thead>
                <tbody>
                {% for process in processList %}
                    <tr>
                        <td>
                            {% if process.status == "pickup" or process.status == "pending" %}
                                <a tabindex="1" href="{{ urlGet("pickup", {}, {}) }}">
                                    {{process.clients.0.familyName}} ({{process.displayNumber}})
                                </a>
                            {% else %}
                                <a tabindex="1" href="{{ urlGet("counter", {}, {'selectedprocess': process.id, 'date': process.appointments.0.date|date('Y-m-d'), 'selectedscope': process.scope.id }) }}">
                                    {{process.clients.0.familyName}} ({{process.displayNumber}})
                                </a>
                            {% endif %}
                        </td>
                        <td>{{process.appointments.0.date|date('d.m.Y, H:i')}}&nbsp;Uhr</td>
                        <td>{{process.scope.contact.name}} {{process.scope.shortName}}</td>
                        <td>{{process.clients.0.telephone}}</td>
                        <td>{{process.clients.0.email}}</td>
                        <td>{{process.amendment}}</td>
                    </tr>
                {% endfor %}
                {% for process in processListOther %}
                    <tr>
                        <td>
                            {{process.clients.0.familyName}} ({{process.displayNumber}})
                        </td>
                        <td>{{process.appointments.0.date|date('d.m.Y, H:i')}}&nbsp;Uhr</td>
                        <td>{{process.scope.contact.name}} {{process.scope.shortName}}</td>
                        <td colspan="4"><small>(nicht im aktuellen Standort)</small></td>
                    </tr>
                {% endfor %}
                {% if processList.count() == 0 and processListOther.count() == 0 %}
                    <tr>
                        <td colspan="7" tabindex="1">Keine Ergebnisse gefunden</td>
                    </tr>
                {% endif %}
                {% if logList.count() %}
                    <tr>
                        <th colspan="7">Log-Ergebnisse:</th>
                    </tr>
                    {% for log in logList %}
                        {% set data = log.data %}
                        <tr>
                            <td>{{ log.reference }}</td>
                            <td>{{log.ts|date('d.m.Y, H:i:s')}}&nbsp;Uhr</td>
                            <td colspan="4">
                                {{ log.message }}<br>
                                {% if data is defined %}
                                    {% for key, value in data %}
                                        <b>{{ key }}</b>: {{ value }}<br/>
                                    {% endfor %}
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                {% endif %}
                </tbody>
            </table>
        </div>
        <div>

            {% set currentPage = page %}
            {% set currentPerPage = perPage %}

            <form method="get" action="">
                <input type="hidden" name="query" value="{{ searchProcessQuery }}">
                <input type="hidden" name="service" value="{{ service }}">
                <input type="hidden" name="provider" value="{{ provider }}">
                <input type="hidden" name="user" value="{{ userAction }}">
                <input type="hidden" name="date" value="{{ date }}">
                <label for="perPage">Pro Seite</label>
                <input
                        type="number"
                        id="perPage"
                        name="perPage"
                        value="{{ currentPerPage }}"
                        min="1"
                        style="width: 70px;"
                        onchange="this.form.submit()"
                >
            </form>

            <div class="pagination">
                {% set prevParams = (queryParams ?? {})|merge({
                    'query': searchProcessQuery,
                    'page': currentPage - 1,
                    'perPage': currentPerPage,
                    'service': service,
                    'provider': provider,
                    'user': userAction,
                    'date': date
                }) %}

                {% set nextParams = (queryParams ?? {})|merge({
                    'query': searchProcessQuery,
                    'page': currentPage + 1,
                    'perPage': currentPerPage,
                    'service': service,
                    'provider': provider,
                    'user': userAction,
                    'date': date
                }) %}

                {% if currentPage > 1 %}
                    <a href="?{{ prevParams|url_encode }}">&lt; Vorherige Seite</a>
                {% endif %}

                Seite: {{ currentPage }}

                {% if currentPage < 100 %}
                    <a href="?{{ nextParams|url_encode }}">Nächste Seite &gt;</a>
                {% endif %}
            </div>




        </div>
    {% endblock %}


{% endembed %}
